<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CTC Market Update Map</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <style>
    /* Map container */
    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    /* Toggle bar for desktop */
    #toggle-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #ffffff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      padding: 10px 20px;
      position: absolute;
      top: 20px;
      right: 100px; /* Desktop: aligned to the right */
      z-index: 1000;
      width: 900px; /* Set toggle bar width for desktop */
    }

    #search-bar {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-right: 20px;
      font-size: 14px;
      width: 300px; /* Explicitly set search bar width */
    }

    #layer-options {
      display: flex;
      gap: 10px;
      margin-right: 10px;
    }

    #actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #filter-btn,
    #FMN-btn,
    #share-btn {
      padding: 10px 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #f8f9fa;
      cursor: pointer;
      font-size: 14px;
      color: #333;
      font-weight: bold;
      text-transform: uppercase;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #profile-icon {
      width: 32px;
      height: 32px;
      background: #6c63ff;
      color: white;
      font-size: 16px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      cursor: pointer;
    }

    /* Mobile and tablet responsiveness */
    @media (max-width: 1024px) {
      #toggle-bar {
        flex-direction: column;
        align-items: stretch;
        justify-content: center;
        width: 95%;
        max-width: 500px;
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        right: auto;
        padding: 10px;
        gap: 10px;
      }

      #search-bar {
        width: 100%;
        margin-right: 0;
      }

      #layer-options {
        flex-wrap: wrap;
        gap: 10px;
        margin-right: 0;
      }

      #actions {
        width: 100%;
        justify-content: space-between;
      }

      #filter-btn,
      #FMN-btn,
      #share-btn {
        width: 100%;
        height: auto;
        text-align: center;
      }

      #profile-icon {
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>

<div id="map"></div>

<!-- Toggle Bar -->
<div id="toggle-bar">
  <input type="text" id="search-bar" placeholder="Search..." />
  <div id="layer-options">
    <label><input type="radio" name="layer" value="state"> State</label>
    <label><input type="radio" name="layer" value="metro"> Metro</label>
    <label><input type="radio" name="layer" value="county" checked> County</label>
    <label><input type="radio" name="layer" value="city"> City</label>
    <label><input type="radio" name="layer" value="zip"> ZIP</label>
  </div>
  <div id="actions">
    <button id="filter-btn">Filter</button>
    <button id="FMN-btn">Find Dream Neighborhood</button>
    <button id="share-btn">Share</button>
    <div id="profile-icon">R</div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    if (!mapboxgl.supported()) {
      alert('Your browser does not support Mapbox GL JS.');
      return;
    }

    const accessToken = 'pk.eyJ1IjoicnRhbWF5bzciLCJhIjoiY2x0MHN2aXNvMHEzZDJxcXl0ZGdyem12biJ9.jFqQ8YQsP77PJtxgaBhuIg';
    mapboxgl.accessToken = accessToken;

    const settings = {
      desktop: {
        default: { center: [-82.1, 26.3], zoom: 7.4 },
        layers: {
          state: { center: [-86.3, 28.2], zoom: 5.8 },
          metro: { center: [-82.1, 26.3], zoom: 7.4 },
          county: { center: [-82.1, 26.3], zoom: 7.4 },
          city: { center: [-82.1, 26.3], zoom: 7.4 },
          zip: { center: [-82.1, 26.3], zoom: 7.4 }
        }
      },
      tablet: {
        default: { center: [-82.1, 26.3], zoom: 6.8 },
        layers: {
          state: { center: [-86.31, 28], zoom: 5.5 },
          metro: { center: [-82.1, 26.3], zoom: 6.8 },
          county: { center: [-82.1, 26.3], zoom: 6.8 },
          city: { center: [-82.1, 26.3], zoom: 6.8 },
          zip: { center: [-82.1, 26.3], zoom: 6.8 }
        }
      },
      mobile: {
        default: { center: [-81.25, 26.2], zoom: 6.8 },
        layers: {
          state: { center: [-83.6, 28.1], zoom: 5.29 },
          metro: { center: [-81.25, 26.2], zoom: 6.8 },
          county: { center: [-81.25, 26.2], zoom: 6.8 },
          city: { center: [-81, 26], zoom: 6.59 },
          zip: { center: [-81.17, 26.2], zoom: 6.8 }
        }
      }
    };

    function getDeviceSettings() {
      const screenWidth = window.innerWidth;
      if (screenWidth > 1024) return settings.desktop;
      if (screenWidth > 768) return settings.tablet;
      return settings.mobile;
    }

    const deviceSettings = getDeviceSettings();

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/rtamayo7/cm8sape5r00jc01s354wd73jd',
      center: deviceSettings.default.center,
      zoom: deviceSettings.default.zoom
    });

    const nav = new mapboxgl.NavigationControl();
    map.addControl(nav, 'top-right');

    const scale = new mapboxgl.ScaleControl({ maxWidth: 100, unit: 'imperial' });
    map.addControl(scale, 'bottom-right');

    const layerMap = {
      state: ['ctc-florida-fill', 'ctc-florida-label'],
      metro: ['ctc-core7-msas-fill', 'ctc-core7-msas-label'],
      county: ['ctc-core7-counties-fill', 'ctc-core7-counties-label'],
      city: ['ctc-core7-cities-fill', 'ctc-core7-cities-label'],
      zip: ['ctc-core7-zipcodes-fill', 'ctc-core7-zipcodes-label']
    };

    function toggleLayerVisibility(selectedLayer) {
      Object.keys(layerMap).forEach(layerGroup => {
        layerMap[layerGroup].forEach(layerId => {
          if (map.getLayer(layerId)) {
            map.setLayoutProperty(layerId, 'visibility', 'none');
          }
        });
      });

      layerMap[selectedLayer].forEach(layerId => {
        if (map.getLayer(layerId)) {
          map.setLayoutProperty(layerId, 'visibility', 'visible');
        }
      });

      const layerSettings = deviceSettings.layers[selectedLayer];
      if (layerSettings) {
        map.flyTo({ center: layerSettings.center, zoom: layerSettings.zoom });
      }
    }

    map.on('load', () => {
      toggleLayerVisibility('county');

      document.querySelectorAll('input[name="layer"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          toggleLayerVisibility(e.target.value);
        });
      });
    });

    window.addEventListener('resize', () => {
      const newDeviceSettings = getDeviceSettings();
      map.flyTo({ center: newDeviceSettings.default.center, zoom: newDeviceSettings.default.zoom });
    });
  });
</script>

</body>
</html>